<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin — Nour Orthopaedics</title>
  <style>
    body{font-family:Inter,system-ui,sans-serif;background:#fafbfd;color:#0e1a37;margin:0;padding:20px}
    input,button{padding:8px;margin:4px 0;border:1px solid #dbe2ee;border-radius:8px}
    .btn{cursor:pointer;font-weight:600}
    .btn-primary{background:#2878ff;color:#fff;border:none;padding:8px 14px}
    .card{background:#fff;border:1px solid #e7ebf3;border-radius:14px;padding:12px;margin:10px 0}
    .hidden{display:none}
  </style>
</head>
<body>
  <div id="login">
    <h1>Admin Login</h1>
    <input type="password" id="password" placeholder="Enter password">
    <button class="btn btn-primary" onclick="login()">Login</button>
  </div>

  <div id="dashboard" class="hidden">
    <h1>Product Manager</h1>
    <input type="text" id="name_en" placeholder="Product name (English)"><br>
    <input type="text" id="name_ar" placeholder="Product name (Arabic)"><br>
    <input type="file" id="fileInput"><br>
    <input type="number" id="price" placeholder="Price (USD)" step="0.01"><br>
    <button class="btn btn-primary" onclick="addProduct()">Save Product</button>

    <h3>Current Products</h3>
    <div id="product-list"></div>
  </div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } 
    from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBPycKJcjB_WvO8D1hD7niGkVmu9Hdo1SU",
    authDomain: "nour-69023.firebaseapp.com",
    projectId: "nour-69023",
    storageBucket: "nour-69023.firebasestorage.app",
    messagingSenderId: "627707212129",
    appId: "1:627707212129:web:0c8f5d27f2716378201520",
    measurementId: "G-41F577G78H"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const ADMIN_PASS="nour2025"; // change this password

  // Cloudinary
  const CLOUD_NAME = "YOUR_CLOUD_NAME";
  const UPLOAD_PRESET = "YOUR_UPLOAD_PRESET";

  function login(){
    if(document.getElementById('password').value===ADMIN_PASS){
      document.getElementById('login').classList.add('hidden');
      document.getElementById('dashboard').classList.remove('hidden');
      loadProducts();
    } else alert("Wrong password");
  }

  async function uploadImage(file){
    const formData = new FormData();
    formData.append("file", file);
    formData.append("upload_preset", UPLOAD_PRESET);

    const res = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`, {
      method: "POST",
      body: formData
    });

    const data = await res.json();
    return data.secure_url;
  }

  async function addProduct(){
    const en=document.getElementById("name_en").value.trim();
    const ar=document.getElementById("name_ar").value.trim();
    const file=document.getElementById("fileInput").files[0];
    const price=parseFloat(document.getElementById("price").value);

    if(!en||isNaN(price)||!file){
      alert("Enter product name, price, and choose a photo");
      return;
    }

    const imageUrl = await uploadImage(file);

    await addDoc(collection(db, "products"), {
      name: en,
      name_ar: ar,
      price: price,
      image: imageUrl
    });

    alert("Product saved!");
    document.getElementById("name_en").value="";
    document.getElementById("name_ar").value="";
    document.getElementById("fileInput").value="";
    document.getElementById("price").value="";
    loadProducts();
  }

  async function loadProducts(){
    const list=document.getElementById("product-list");list.innerHTML="";
    const snapshot=await getDocs(collection(db,"products"));
    snapshot.forEach((d)=>{
      const p=d.data();
      let div=document.createElement("div");
      div.className="card";
      div.innerHTML=`<strong>${p.name}</strong> / ${p.name_ar || "—"} — $${p.price.toFixed(2)}<br>
        <img src="${p.image}" style="max-width:100px"><br>`;
      list.appendChild(div);
    });
  }
</script>
</body>
</html>